"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[295],{6295:function(e,t,s){s.r(t),s.d(t,{default:function(){return C}});var r=function(){var e=this,t=e._self._c;return t("div",[t("WrapComponent",[t("el-button",{staticClass:"pri-add-btn",attrs:{slot:"operate",type:"primary",icon:"el-icon-circle-plus"},on:{click:function(t){return e.onOperate("new")}},slot:"operate"},[e._v(" 新增用户 ")]),t("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{slot:"form",model:e.searchForm,inline:!0},slot:"form"},[t("el-form-item",{attrs:{label:"用户名 / 昵称",prop:"keyword"}},[t("el-input",{attrs:{placeholder:"用户名 / 昵称"},model:{value:e.searchForm.keyword,callback:function(t){e.$set(e.searchForm,"keyword",t)},expression:"searchForm.keyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.getUserList}},[e._v("搜索")]),t("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.resetForm}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{slot:"table",data:e.tableData,"header-cell-style":{background:"rgba(144, 147, 153, 0.06)",color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"}},slot:"table"},[t("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"nickname",label:"昵称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"isSuperuser",label:"是否管理员","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"320px"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.resetPWD(s.row.id)}}},[e._v("重置密码")]),t("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:function(t){return e.onOperate("edit",s.row.id)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(t){return e.onDel("删除",s.row)}}},[e._v("删除")])],1)]}}])})],1),t("div",{staticClass:"content-footer clear",attrs:{slot:"footer"},slot:"footer"},[t("div",{staticClass:"block page-list self-right"},[t("vue-pagination",e._b({on:{sizeChange:e.changeSize,currentPageChange:e.changeCurrentPage}},"vue-pagination",e.pageParams,!1))],1)])],1),t("AddUserDialog",{attrs:{dialogFormVisible:e.dialogFormVisible,dialogTitle:e.dialogTitle,id:e.curId},on:{"update:dialogFormVisible":function(t){e.dialogFormVisible=t},"update:dialog-form-visible":function(t){e.dialogFormVisible=t},success:e.resetForm}})],1)},a=[],i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrap"},[e.showOperateCont?t("div",{staticClass:"control-list",staticStyle:{float:"left"}},[e._t("operate")],2):e._e(),t("div",{staticClass:"content-info",staticStyle:{clear:"both"}},[2===e.searchLayout?[e._t("form")]:t("div",{staticClass:"content-header clear"},[t("div",{staticClass:"self-left info-name"},[e._v(e._s(e.tableTitle))]),t("div",{staticClass:"self-right"},[e._t("form")],2)]),t("div",{staticClass:"content-table"},[e._t("table")],2),e._t("footer")],2)])},o=[],l={name:"WrapComponent",props:{searchLayout:{type:Number,default:2},showOperateCont:{type:Boolean,default:!0}}},n=l,u=s(1001),m=(0,u.Z)(n,i,o,!1,null,null,null),c=m.exports,d=s(5827),p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrap"},[t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.visible,width:"600px","close-on-click-modal":!1},on:{close:e.onResetForm}},[t("el-form",{ref:"userFormRef",staticClass:"form-common",attrs:{model:e.userForm,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入用户名"},model:{value:e.userForm.username,callback:function(t){e.$set(e.userForm,"username",t)},expression:"userForm.username"}})],1),t("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[t("el-input",{staticClass:"input-380",attrs:{placeholder:"请输入昵称"},model:{value:e.userForm.nickname,callback:function(t){e.$set(e.userForm,"nickname",t)},expression:"userForm.nickname"}})],1),t("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"是否管理员"}},[t("el-radio-group",{model:{value:e.userForm.isSuperuser,callback:function(t){e.$set(e.userForm,"isSuperuser",t)},expression:"userForm.isSuperuser"}},[t("el-radio",{attrs:{label:0}},[e._v("否")]),t("el-radio",{attrs:{label:1}},[e._v("是")])],1)],1),e.id?e._e():[t("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"初始密码"}},[t("span",[e._v("123456")])])]],2),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.onResetForm}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)],1)},h=[],g=s(2300),f={name:"AddUser",props:{dialogTitle:{type:String,default:"新增"},dialogFormVisible:{type:Boolean,default:!1},id:{type:String,default:""}},computed:{visible(){return this.dialogFormVisible}},watch:{dialogFormVisible(e){e&&this.id&&this.getDetail()}},data(){return{isLoading:!1,userForm:{username:"",nickname:"",password:"123456",isSuperuser:0},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:g.qg,trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{validator:g.qg,trigger:"blur"}]}}},methods:{getDetail(){this.$http.get(`/users/${this.id}`).then((({data:e})=>{this.userForm.username=e.data.username,this.userForm.nickname=e.data.nickname,this.userForm.isSuperuser=e.data.isSuperuser}))},onResetForm(){this.$refs.userFormRef.resetFields(),this.isLoading=!1,this.id&&(this.userForm.username="",this.userForm.nickname=""),this.$emit("update:dialogFormVisible",!1)},onSubmit(){this.$refs.userFormRef.validate((e=>{e&&(this.userForm.username=this.userForm.username.trim(),this.userForm.nickname=this.userForm.nickname.trim(),this.isLoading=!0,this.onRequest())}))},onRequest(){const{username:e,nickname:t,isSuperuser:s,password:r}=this.userForm;let a={username:e,nickname:t,isSuperuser:s,password:r},i="post",o="/users/";this.id&&(i="put",o=`/users/${this.id}`),this.$http[i](o,a).then((()=>{this.$notifyMessage("保存成功",{type:"success"}),this.onResetForm(),this.$emit("success")})).finally((()=>{this.isLoading=!1}))}}},b=f,F=(0,u.Z)(b,p,h,!1,null,null,null),v=F.exports,k={name:"UserView",components:{WrapComponent:c,AddUserDialog:v},data(){return{loading:!1,dialogFormVisible:!1,dialogTitle:"新增用户",curId:"",searchForm:{keyword:"",status:""},tableData:[],pageParams:{currentPage:1,pageSize:10,totalNum:0}}},created(){this.getUserList()},methods:{onOperate(e,t=""){const s={new:"新增用户",edit:"编辑用户"};this.dialogTitle=s[e],this.dialogFormVisible=!0,this.curId=t},resetPWD(e){(0,d.Gq)("确认重置此用户的密码？",(()=>{this.$http.put(`/users/${e}/reset-password`).then((({data:e})=>{e&&(0,d.Gq)(`登录密码已重置为默认密码“${e.data}”`,null,{confirmButtonText:"我已知晓",showCancelButton:!1,confirmButtonClass:"el-button--primary",type:"success"}),this.getUserList()}))}),{confirmButtonText:"重置"})},onDel(e,t){"启用"!==e?(0,d.Gq)(`是否${e}此账号？`,(()=>{this.operateRow(e,t)}),{confirmButtonText:e}):this.operateRow(e,t)},operateRow(e,{id:t}){let s,r,a={};"删除"===e&&(s=`/users/${t}`,r="delete"),this.$http[r](s,a).then((()=>{this.$notifyMessage(`${e}成功`,{type:"success"}),this.getUserList()}))},getUserList(){this.loading=!0;let e={...this.searchForm,page:this.pageParams.currentPage,perPage:this.pageParams.pageSize,sortField:"id"};this.$http.get("/users",{params:(0,d.aH)(e)}).then((({data:{data:e}})=>{let t=e.list,s=e.total;this.pageParams.totalNum=s,t?this.tableData=t.map((e=>({id:e.id,username:e.username,nickname:e.nickname,isSuperuser:e.isSuperuser}))):(s>0&&this.pageParams.currentPage>1&&(this.pageParams.currentPage--,this.getUserList()),this.tableData=[])})).finally((()=>{this.loading=!1}))},resetForm(){this.$refs.searchForm.resetFields(),this.getUserList()},changeSize(e){this.pageParams.pageSize=e,this.pageParams.currentPage=1,this.getUserList()},changeCurrentPage(e){this.pageParams.currentPage=e,this.getUserList()}}},w=k,y=(0,u.Z)(w,r,a,!1,null,null,null),C=y.exports}}]);
//# sourceMappingURL=295.6c4ff81b.js.map